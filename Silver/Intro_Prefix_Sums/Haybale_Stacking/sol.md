Lo primero a intentar es procesar cada instrucción incrementando los elementos del rango $[L, R]$ uno por uno. Este proceso lleva tiempo $O(N \times Q)$ en total, lo cuál es demasiado tiempo para los límites del problema.

Si pensamos este problema en el contexto del algoritmo de sumas parciales, necesitamos el inverso a dicha optimización. En sumas parciales hacíamos un pre-procesamiento de $O(N)$ para que cada instrucción (o query) nos lleve tiempo constante $O(1)$. En este caso necesitamos que suceda lo contrario, que cada instrucción debe llevarnos tiempo $O(1)$ sin ningún pre-procesamiento inicial, y que al final hagamos una operación de $O(N)$ para reconstruir el arreglo. ¿Cómo podemos procesar una instrucción $[L, R]$ sin incrementar todos los números en el rango? La idea es mantener un arreglo $D$ de diferencias consecutivas. Definimos $D[0] = 0$ y $D[i] = A[i] - A[i-1]$ para $1 \leq i \leq N$ (aquí asumimos que el arreglo esté indexado). Si al final tenemos el arreglo $D$ completo, podemos reconstruir el arreglo original iterativamente manipulando la misma fórmula $A[i] = A[i-1] + D[i]$ en $O(N)$. Para procesar cada instrucción $[L, R]$ en el arreglo $D$ podemos notar que $D[L]$ se incrementa en 1, todos los elementos entre $L+1$ y $R$ no cambian ya que todos se incrementan en 1 y sus diferencias consecutivas se mantienen iguales, y $D[R+1]$ se decrementa en 1. Una vez procesamos todas las instrucciones, simplemente ordenamos el arreglo original y accedemos al elemento $N/2 + 1$ (si indexamos desde el 1).

El tiempo total del algoritmo incluido el ordenamiento termina siendo $O(Q + N) + O(N \log N)$.

Notar que ya que $R$ puede ser $N$ y no utilizamos el elemento 0, es importante que el arreglo $D$ tenga tamaño $N+2$ si decidimos que el arreglo original tenga tamaño $N+1$ (indexado desde 0).

Como comentario adicional, las sumas parciales y diferencias consecutivas son el análogo discreto a las integrales y las derivadas que operan en un rango continuo. Lo importante de eso es que son funciones inversas, ya que para reconstruir el arreglo original tuvimos que hacer sumas parciales sobre el arreglo de diferencias consecutivas. Esto es similar a lo que dice el teorema fundamental del cálculo respecto a las derivadas e integrales.